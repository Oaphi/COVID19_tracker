<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: analytics.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: analytics.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * @typedef {object} analyticsConfig
 * @property {string} [baseURI] analytics URI
 * @property {string} [cid] client ID (autogenerated by default)
 * @property {string} [tid] tracking ID
 * @property {("email")} ec event category
 * @property {string} [el] event label
 * @property {string} ev event value
 */

/**
 * @typedef {object} documentAnalyticsConfig
 * @property {string} [dp] document path, like /email/newsletter
 * @property {string} [dt] document title, like "Newsletter"
 */

/**
 * @typedef {object} clickAnalyticsConfig
 * @property {string} //source,  utm_source
 * @property {string} //medium,  utm_medium
 * @property {string} //product, utm_campaign
 * 
 */

/**
 * @typedef {analyticsConfig &amp; documentAnalyticsConfig} fullAnalyticsConfig
 */

/**
 * @typedef {analyticsConfig &amp; clickAnalyticsConfig} fullClickAnalyticsConfig
 */

/**
 * 
 * @param {fullAnalyticsConfig} config
 * @param {("open"|"click")} eventType 
 */
const makeAnalyticsQuery = (config, eventType) => {
    const cacheBuster = Math.floor((Math.random() * 1e10));

    const { cid, dp, dt, el, ev } = config;

    const validParams = {
        v: 1,
        tid: "UA-167977153-1",
        t: "event",
        ec: "email",
        ea: eventType,
        z: cacheBuster,
        cid,
        dp,
        dt,
        el,
        ev
    };

    //"el" has to go first as &amp;el is incorrectly encoded in Gmail
    return JSONtoQuery(validParams, {
        encodeParams: true,
        paramOrder: ["el", "tid", "cid", "v", "t", "ec", "ea", "ev", "dp", "dt", "z"]
    });
};

/**
 * @param {Candidate} candidate
 * @param {fullAnalyticsConfig} [config] 
 * @returns {string}
 */
const trackEmailOpen = (candidate, config = {}) => {

    try {

        const { baseURI = "https://www.google-analytics.com/collect" } = config;

        config.cid = candidate.id;
        config.dt = "COVID-19 Tracking Email";

        const query = makeAnalyticsQuery(config, "open");

        const fullURI = `${baseURI}?${query}`;

        // return `&lt;img src="${fullURI}" />`;
        return "";
    }
    catch (error) {
        console.warn(error);
        return "";
    }
};

/**
 * @summary enables link tracking
 * @param {string} anchor 
 * @param {Candidate} candidate
 * @param {fullClickAnalyticsConfig} [config]
 * @returns {string}
 */
const trackLinkClick = (anchor, candidate, config = {}) => {

    try {

        const { baseURI = "https://www.google-analytics.com/collect" } = config;

        const query = makeAnalyticsQuery(config, "click");

        const hasRefSet = /\w+?(\w|\d)+/.test(anchor);

        return "";

    }
    catch (error) {
        console.warn(error);
        return anchor;
    }

};

/**
 * @typedef {({
 *  id : (string | undefined),
 *  uuids : (string[] | undefined)
 * })} uuidGetterConfig
 * 
 * @summary guarantees unique uuid in context of id column
 * 
 * @param {uuidGetterConfig} config
 * @returns {string[]}
 */
const getUuidUntilUnique = (
    {
        id = Utilities.getUuid(),
        uuids = []
    }
) => {

    if (id &amp;&amp; uuids.indexOf(id) === -1) {
        uuids.push(id);
        return uuids;
    }

    return getUuidUntilUnique({ uuids });
};</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Global</h3><ul><li><a href="global.html#addCommas">addCommas</a></li><li><a href="global.html#addSign">addSign</a></li><li><a href="global.html#buildRatioStatement">buildRatioStatement</a></li><li><a href="global.html#buildStatement">buildStatement</a></li><li><a href="global.html#colorLink">colorLink</a></li><li><a href="global.html#Covid19Refresh">Covid19Refresh</a></li><li><a href="global.html#Covid19Refresh_BACKUP">Covid19Refresh_BACKUP</a></li><li><a href="global.html#datenumToValue">datenumToValue</a></li><li><a href="global.html#deep">deep</a></li><li><a href="global.html#doApprove">doApprove</a></li><li><a href="global.html#fetchAndParseContent">fetchAndParseContent</a></li><li><a href="global.html#getcelldate">getcelldate</a></li><li><a href="global.html#getCurrentlySelectedCandidate">getCurrentlySelectedCandidate</a></li><li><a href="global.html#getDayOfWeek">getDayOfWeek</a></li><li><a href="global.html#getIndexFromA1">getIndexFromA1</a></li><li><a href="global.html#getIndices">getIndices</a></li><li><a href="global.html#getOrInitProp">getOrInitProp</a></li><li><a href="global.html#getOrInstallInfectionsByTests">getOrInstallInfectionsByTests</a></li><li><a href="global.html#getOrIntallTrigger">getOrIntallTrigger</a></li><li><a href="global.html#getResetDateValue">getResetDateValue</a></li><li><a href="global.html#getSavedState">getSavedState</a></li><li><a href="global.html#getTotalByUS">getTotalByUS</a></li><li><a href="global.html#getUserEmail">getUserEmail</a></li><li><a href="global.html#GreenRed2">GreenRed2</a></li><li><a href="global.html#handleError">handleError</a></li><li><a href="global.html#include">include</a></li><li><a href="global.html#infectionsByTestsByCountry">infectionsByTestsByCountry</a></li><li><a href="global.html#insallTrigger">insallTrigger</a></li><li><a href="global.html#installInfectionsByTests">installInfectionsByTests</a></li><li><a href="global.html#isZero">isZero</a></li><li><a href="global.html#JSONtoQuery">JSONtoQuery</a></li><li><a href="global.html#LoadTwitter">LoadTwitter</a></li><li><a href="global.html#makeAnalyticsQuery">makeAnalyticsQuery</a></li><li><a href="global.html#metricPerMillions">metricPerMillions</a></li><li><a href="global.html#onOpen">onOpen</a></li><li><a href="global.html#ordinal_suffix_of">ordinal_suffix_of</a></li><li><a href="global.html#percentToPreviousWeek">percentToPreviousWeek</a></li><li><a href="global.html#pluralizeCountable">pluralizeCountable</a></li><li><a href="global.html#promptSendoutStats">promptSendoutStats</a></li><li><a href="global.html#RedGreen2">RedGreen2</a></li><li><a href="global.html#resetPersistedState">resetPersistedState</a></li><li><a href="global.html#safeApprove">safeApprove</a></li><li><a href="global.html#sandboxApprove">sandboxApprove</a></li><li><a href="global.html#sendout">sendout</a></li><li><a href="global.html#sentenceCase">sentenceCase</a></li><li><a href="global.html#setDecimalPlaces">setDecimalPlaces</a></li><li><a href="global.html#SheetIndices">SheetIndices</a></li><li><a href="global.html#splitIntoConseq">splitIntoConseq</a></li><li><a href="global.html#topercent">topercent</a></li><li><a href="global.html#trackEmailOpen">trackEmailOpen</a></li><li><a href="global.html#trackLinkClick">trackLinkClick</a></li><li><a href="global.html#updateInfectsionsByTests">updateInfectsionsByTests</a></li><li><a href="global.html#validForSending">validForSending</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.4</a> on Sun Jun 21 2020 07:57:02 GMT+0300 (Moscow Standard Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>

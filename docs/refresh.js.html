<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: refresh.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: refresh.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * @summary refreshes COVID data
 * @returns {void}
 */
function Covid19Refresh() {

    getOrInstallInfectionsByTests();

    const ss = SpreadsheetApp.getActiveSpreadsheet();

    var sheet1 = ss.getSheetByName(CONFIG.rawStateStatsShName);
    var sheet2 = ss.getSheetByName(CONFIG.rawCountryStatsShName);
    var Covid19sh = ss.getSheetByName(CONFIG.statsShName);

    var data1 = fetchAndParseContent("https://covidtracking.com/api/states/daily");
    
    console.log(data1[0]);

    var inputdata1 = data1.map(data => {

        const { date, state, positive } = data;

        const inputrow = [
            date,
            state,
            positive,
            data.negative,
            data.pending,
            data.hospitalizedCurrently,
            data.hospitalizedCumulative,
            data.inIcuCurrently,
            data.inIcuCumulative,
            data.onVentilatorCurrently,
            data.onVentilatorCumulative,
            data.recovered,
            data.hash,
            data.dateChecked,
            data.death,
            data.hospitalized,
            data.total,
            data.totalTestResults,
            data.posNeg,
            data.fips,
            data.deathIncrease,
            data.hospitalizedIncrease,
            data.negativeIncrease,
            data.positiveIncrease,
            data.totalTestResultsIncrease
        ];

        for (let ii = 0; ii &lt; 5; ii++) {
            const offset20 = ii + 20;

            if (inputrow[offset20] &lt; 0) {
                inputrow[offset20] = 0;
            }
        }

        return inputrow;
    });

    var data2 = fetchAndParseContent("https://covidtracking.com/api/us/daily");
    
    console.log(data2[0]);

    var inputdata2 = data2.map(data => {

        const { date, states, positive, negative } = data;

        let inputrow = [
            date,
            states,
            positive,
            negative,
            data.pending,
            data.hospitalizedCurrently,
            data.hospitalizedCumulative,
            data.inIcuCurrently,
            data.inIcuCumulative,
            data.onVentilatorCurrently,
            data.onVentilatorCumulative,
            data.recovered,
            data.hash,
            data.dateChecked,
            data.death,
            data.hospitalized,
            data.total,
            data.totalTestResults,
            data.posNeg,
            data.deathIncrease,
            data.hospitalizedIncrease,
            data.negativeIncrease,
            data.positiveIncrease,
            data.totalTestResultsIncrease
        ];

        for (let ii = 0; ii &lt; 5; ii++) {
            const offset19 = ii + 19;

            if (inputrow[offset19] &lt; 0) {
                inputrow[offset19] = 0;
            }
        }
        
        return inputrow;
    });

    var range1 = sheet1.getRange(2, 1, data1.length, 25);
    range1.setValues(inputdata1);

    var range2 = sheet2.getRange(2, 1, data2.length, 24);
    range2.setValues(inputdata2);

    Covid19sh.getRange(3, 1).setValue("Last Updated : " + new Date());
}

/**
 * @returns {void}
 */
function Covid19Refresh_BACKUP() {

    getOrInstallInfectionsByTests();

    var aUrl = "https://covidtracking.com/api/states/daily";
    var ss = SpreadsheetApp.openByUrl("https://docs.google.com/spreadsheets/d/1Jmy7IqSugeZnHq5oAZV4Mq9w6UfrCbQ9PaLziseG2ME/edit?usp=sharing");
    var ws = ss.getSheetByName("LiveStates");
    ws.getRange(1, 1).setValue('=ImportJSON("' + aUrl + '")');

    var aUrl1 = "https://covidtracking.com/api/us/daily";
    var ws1 = ss.getSheetByName("LiveCountry");
    ws1.getRange(1, 1).setValue('=ImportJSON("' + aUrl1 + '")');

    Utilities.sleep(500);


    var ss1 = SpreadsheetApp.openByUrl("https://docs.google.com/spreadsheets/d/1-UXzdnxM8FE3MAmPFI2CcFOf1KNWSgN5V-68rlBQsSY/edit?usp=sharing");
    var copySheet = ss.getSheetByName("LiveStates");
    var pasteSheet = ss1.getSheetByName("States");
    var Covid19sh = ss1.getSheetByName("Covid19");

    // get source range
    var source01 = copySheet.getRange(1, 1, copySheet.getLastRow() - 1, 12).getValues();
    var source02 = copySheet.getRange(1, 15, copySheet.getLastRow() - 1, copySheet.getLastColumn() - 14).getValues();
    // get destination range
    pasteSheet.getRange(1, 1, copySheet.getLastRow() - 1, 12).setValues(source01);
    pasteSheet.getRange(1, 13, copySheet.getLastRow() - 1, copySheet.getLastColumn() - 14).setValues(source02);


    var copySheet1 = ss.getSheetByName("LiveCountry");
    var pasteSheet1 = ss1.getSheetByName("Country");

    // get source range
    var source1 = copySheet1.getRange(1, 1, copySheet1.getLastRow(), copySheet1.getLastColumn()).getValues();
    // get destination range
    pasteSheet1.getRange(1, 1, copySheet1.getLastRow(), copySheet1.getLastColumn()).setValues(source1);


    Covid19sh.getRange(3, 1).setValue("Last Updated : " + new Date());
    Logger.log("Done");
}</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Global</h3><ul><li><a href="global.html#addCommas">addCommas</a></li><li><a href="global.html#addSign">addSign</a></li><li><a href="global.html#buildRatioStatement">buildRatioStatement</a></li><li><a href="global.html#buildStatement">buildStatement</a></li><li><a href="global.html#colorLink">colorLink</a></li><li><a href="global.html#Covid19Refresh">Covid19Refresh</a></li><li><a href="global.html#Covid19Refresh_BACKUP">Covid19Refresh_BACKUP</a></li><li><a href="global.html#deep">deep</a></li><li><a href="global.html#doApprove">doApprove</a></li><li><a href="global.html#fetchAndParseContent">fetchAndParseContent</a></li><li><a href="global.html#getcelldate">getcelldate</a></li><li><a href="global.html#getCurrentlySelectedCandidate">getCurrentlySelectedCandidate</a></li><li><a href="global.html#getDayOfWeek">getDayOfWeek</a></li><li><a href="global.html#getOrInitProp">getOrInitProp</a></li><li><a href="global.html#getOrInstallInfectionsByTests">getOrInstallInfectionsByTests</a></li><li><a href="global.html#getOrIntallTrigger">getOrIntallTrigger</a></li><li><a href="global.html#getSavedState">getSavedState</a></li><li><a href="global.html#getTotalByUS">getTotalByUS</a></li><li><a href="global.html#GreenRed2">GreenRed2</a></li><li><a href="global.html#handleError">handleError</a></li><li><a href="global.html#include">include</a></li><li><a href="global.html#infectionsByTestsByCountry">infectionsByTestsByCountry</a></li><li><a href="global.html#insallTrigger">insallTrigger</a></li><li><a href="global.html#installInfectionsByTests">installInfectionsByTests</a></li><li><a href="global.html#isZero">isZero</a></li><li><a href="global.html#JSONtoQuery">JSONtoQuery</a></li><li><a href="global.html#LoadTwitter">LoadTwitter</a></li><li><a href="global.html#makeAnalyticsQuery">makeAnalyticsQuery</a></li><li><a href="global.html#onOpen">onOpen</a></li><li><a href="global.html#ordinal_suffix_of">ordinal_suffix_of</a></li><li><a href="global.html#pluralizeCountable">pluralizeCountable</a></li><li><a href="global.html#promptSendoutStats">promptSendoutStats</a></li><li><a href="global.html#RedGreen2">RedGreen2</a></li><li><a href="global.html#resetPersistedState">resetPersistedState</a></li><li><a href="global.html#sandboxApprove">sandboxApprove</a></li><li><a href="global.html#sendout">sendout</a></li><li><a href="global.html#sentenceCase">sentenceCase</a></li><li><a href="global.html#setDecimalPlaces">setDecimalPlaces</a></li><li><a href="global.html#splitIntoConseq">splitIntoConseq</a></li><li><a href="global.html#topercent">topercent</a></li><li><a href="global.html#trackEmailOpen">trackEmailOpen</a></li><li><a href="global.html#trackLinkClick">trackLinkClick</a></li><li><a href="global.html#updateInfectsionsByTests">updateInfectsionsByTests</a></li><li><a href="global.html#validForSending">validForSending</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.4</a> on Tue Jun 02 2020 13:26:59 GMT+0300 (Moscow Standard Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
